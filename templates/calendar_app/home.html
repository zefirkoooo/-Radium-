{% extends 'calendar_app/base.html' %}
{% load static %}

{% block extra_css %}
<link href="{% static 'css/home.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="calendar-container">
    <div class="header-section">
        <h1 class="main-title">–ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–∏—Ç–∞–Ω–∏—è</h1>
        {% if user.is_admin or user.is_superuser or user.is_staff %}
        <div class="upload-controls">
            <button class="btn btn-secondary" onclick="document.getElementById('menu-file').click()">
                <i class="fas fa-file"></i> –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª
            </button>
            <span class="file-status">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
            <input type="file" id="menu-file" style="display: none;" accept=".xlsx,.xls">
            <div class="parser-select">
                <label>
                    <input type="radio" name="parser_type" value="standard" checked> –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ä—Å–µ—Ä
                </label>
                <label>
                    <input type="radio" name="parser_type" value="smart"> –£–º–Ω—ã–π –ø–∞—Ä—Å–µ—Ä
                </label>
            </div>
            <button class="btn btn-primary" onclick="uploadFile()" id="upload-btn" disabled>
                <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–Ω—é
            </button>
            <form method="post" action="{% url 'clear_calendar' %}" class="d-inline" onsubmit="return confirm('–í–ù–ò–ú–ê–ù–ò–ï! –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –º–µ–Ω—é –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ –±–ª—é–¥–∞ –∏ –≤—ã–±–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm" title="–û—á–∏—Å—Ç–∏—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å">
                    <i class="fas fa-trash-alt"></i> –û—á–∏—Å—Ç–∏—Ç—å –º–µ–Ω—é
                </button>
            </form>
        </div>
        {% endif %}
    </div>

    <div class="user-info">
        <i class="fas fa-user"></i> –í—ã–±—Ä–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <strong>{{ user.username }}</strong>
    </div>

    <h2 class="week-title">–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è</h2>
    <div class="week-grid">
        {% for day_menu in current_week_menu %}
        <div class="day-card">
            <h3>{{ day_menu.date|date:"l, j E Y"|default_if_none:"" }}</h3>
            <div class="selected-dishes">
                {% if day_menu.user_selection %}
                    {% if day_menu.user_selection.selected_salad %}
                        <div class="dish-row">ü•ó –°–∞–ª–∞—Ç ‚Äî {{ day_menu.user_selection.selected_salad.name }}</div>
                    {% endif %}
                    {% if day_menu.user_selection.selected_soup %}
                        <div class="dish-row">ü•£ –°—É–ø ‚Äî {{ day_menu.user_selection.selected_soup.name }}</div>
                    {% endif %}
                    {% if day_menu.user_selection.selected_main %}
                        <div class="dish-row">üçñ –û—Å–Ω–æ–≤–Ω–æ–µ ‚Äî {{ day_menu.user_selection.selected_main.name }}</div>
                    {% endif %}
                    {% if day_menu.user_selection.selected_side %}
                        <div class="dish-row">ü•î –ì–∞—Ä–Ω–∏—Ä ‚Äî {{ day_menu.user_selection.selected_side.name }}</div>
                    {% endif %}
                    {% if day_menu.user_selection.selected_bakery %}
                        <div class="dish-row">ü•® –í—ã–ø–µ—á–∫–∞ ‚Äî {{ day_menu.user_selection.selected_bakery.name }}</div>
                    {% endif %}
                {% else %}
                    <div class="dish-row empty">‚ùå –ë–ª—é–¥–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="no-menu">
            <p>–ù–µ—Ç –º–µ–Ω—é –Ω–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é</p>
        </div>
        {% endfor %}
    </div>

    <h2 class="week-title">–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è</h2>
    <div class="week-grid">
        {% for day_menu in next_week_menu %}
        <div class="day-card">
            <h3>{{ day_menu.date|date:"l, d F Y" }}</h3>
            <div class="meal-select">
                <a href="{% url 'day_detail' day_menu.id %}" class="btn btn-primary">
                    <i class="fas fa-utensils"></i> –í—ã–±—Ä–∞—Ç—å –±–ª—é–¥–∞
                </a>
            </div>
            <div class="selected-dishes">
                {% if day_menu.user_selection %}
                    {% if day_menu.user_selection.selected_salad %}
                        <div class="dish-row">ü•ó –°–∞–ª–∞—Ç ‚Äî {{ day_menu.user_selection.selected_salad.name }}</div>
                    {% endif %}
                    {% if day_menu.user_selection.selected_soup %}
                        <div class="dish-row">ü•£ –°—É–ø ‚Äî {{ day_menu.user_selection.selected_soup.name }}</div>
                    {% endif %}
                    {% if day_menu.user_selection.selected_main %}
                        <div class="dish-row">üçñ –û—Å–Ω–æ–≤–Ω–æ–µ ‚Äî {{ day_menu.user_selection.selected_main.name }}</div>
                    {% endif %}
                    {% if day_menu.user_selection.selected_side %}
                        <div class="dish-row">ü•î –ì–∞—Ä–Ω–∏—Ä ‚Äî {{ day_menu.user_selection.selected_side.name }}</div>
                    {% endif %}
                    {% if day_menu.user_selection.selected_bakery %}
                        <div class="dish-row">ü•® –í—ã–ø–µ—á–∫–∞ ‚Äî {{ day_menu.user_selection.selected_bakery.name }}</div>
                    {% endif %}
                {% else %}
                    <div class="dish-row empty">‚ùå –ë–ª—é–¥–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="no-menu">
            <p>–ù–µ—Ç –º–µ–Ω—é –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/home.js' %}"></script>
{% endblock %}